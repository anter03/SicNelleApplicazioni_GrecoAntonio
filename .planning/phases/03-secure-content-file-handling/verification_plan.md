---
must_haves:
  truths:
    - "An authenticated user can upload a .txt file."
    - "The application rejects non-text files disguised as .txt files, and also rejects files with non-.txt extensions."
    - "Uploaded textual content is stored securely, preventing SQL Injection."
    - "Uploaded textual content is displayed on a web page, preventing XSS attacks."
  artifacts:
    - path: "src/main/java/com/sicnelleapplicazioni/servlet/FileUploadServlet.java"
      provides: "Handles file upload, extension check, and Tika validation."
      patterns:
        - "doPost"
        - "getPart"
        - "\\.txt\""
        - "TikaConfig.getDefaultConfig().getDetector().detect"
        - "MediaType.TEXT_PLAIN"
        - "contentRepository.save"
    - path: "src/main/webapp/upload.jsp"
      provides: "Upload form for textual content."
      patterns:
        - "<form"
        - "action=\\"upload\\""
        - "enctype=\\"multipart/form-data\\""
        - "<input type=\\"file\\""
    - path: "pom.xml"
      provides: "Apache Tika dependency."
      patterns:
        - "<artifactId>tika-core</artifactId>"
        - "<artifactId>tika-parsers-standard-modules</artifactId>"
    - path: "src/main/java/com/sicnelleapplicazioni/model/Content.java"
      provides: "Content model for uploaded text."
      patterns:
        - "private String id;"
        - "private String filename;"
        - "private String contentText;"
        - "private String userId;"
    - path: "src/main/java/com/sicnelleapplicazioni/repository/ContentRepository.java"
      provides: "Interface for content data access."
      patterns:
        - "interface ContentRepository"
        - "void save(Content content)"
        - "Optional<Content> findById(String id)"
    - path: "src/main/java/com/sicnelleapplicazioni/repository/JdbcContentRepository.java"
      provides: "JDBC implementation for content data access using PreparedStatements."
      patterns:
        - "class JdbcContentRepository implements ContentRepository"
        - "PreparedStatement"
        - "INSERT INTO content"
        - "SELECT id, filename, contentText, userId FROM content WHERE id = ?"
    - path: "src/main/java/com/sicnelleapplicazioni/servlet/DisplayContentServlet.java"
      provides: "Servlet to display content."
      patterns:
        - "doGet"
        - "contentRepository.findById"
        - "request.setAttribute(\\"content\\""
        - "request.getRequestDispatcher(\\"/displayContent.jsp\\").forward"
    - path: "src/main/webapp/displayContent.jsp"
      provides: "JSP to display content with XSS protection."
      patterns:
        - "<c:out value=\\""
        - "\${content.contentText}"
        - "Filename: <c:out value=\\""
  key_links:
    - from: "src/main/java/com/sicnelleapplicazioni/servlet/FileUploadServlet.java"
      to: "src/main/java/com/sicnelleapplicazioni/repository/ContentRepository.java"
      via: "contentRepository.save"
    - from: "src/main/webapp/upload.jsp"
      to: "src/main/java/com/sicnelleapplicazioni/servlet/FileUploadServlet.java"
      via: "action=\\"upload\\""
    - from: "src/main/java/com/sicnelleapplicazioni/servlet/DisplayContentServlet.java"
      to: "src/main/java/com/sicnelleapplicazioni/repository/ContentRepository.java"
      via: "contentRepository.findById"
    - from: "src/main/webapp/displayContent.jsp"
      to: "JSTL <c:out>"
      via: "<c:out value=\\"\\${content.contentText}\\"/>"
    - from: "src/main/java/com/sicnelleapplicazioni/servlet/FileUploadServlet.java"
      to: "org.apache.tika.Tika"
      via: "TikaConfig.getDefaultConfig().getDetector().detect"
---
